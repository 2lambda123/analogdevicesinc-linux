# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
# Copyright 2024 Analog Devices Inc.
%YAML 1.2
---
$id: http://devicetree.org/schemas/iio/adc/adi,ad4696.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: Analog Devices AD4696 ADC family device driver

maintainers:
  - Ramona Gradinariu <ramona.gradinariu@analog.com>

description: |
  Analog Devices AD4696 16-Bit Easy Drive Multiplexed SAR ADC

  https://www.analog.com/media/en/technical-documentation/data-sheets/ad4695_4696.pdf
  https://www.analog.com/media/en/technical-documentation/data-sheets/ad4697-4698.pdf

properties:
  compatible:
    enum:
      - adi,ad4695
      - adi,ad4696
      - adi,ad4697
      - adi,ad4698

  reg:
    maxItems: 1

  dmas:
    maxItems: 1

  dma-names:
    const: rx

  clocks:
    maxItems: 1

  clock-names:
    items:
      - const: ref_clk

  pwms:
    maxItems: 1

  pwm-names:
    items:
      - const: cnv

  spi-max-frequency:
    maximum: 80000000

  spi-cpha: true

  spi-cpol: true

  vref-supply:
    description: The regulator supply for ADC reference voltage.

  "#io-channel-cells":
    const: 1

  "#address-cells": true
  "#size-cells": true

required:
  - compatible
  - reg
  - clocks
  - dmas
  - dma-names
  - pwms
  - pwm-names
  - spi-cpol
  - spi-cpha
  - vref-supply
  - "#io-channel-cells"
  - "#address-cells"
  - "#size-cells"

patternProperties:
  "^channel@([0-9]|1[0-5])$":
    $ref: adc.yaml
    type: object
    unevaluatedProperties: false
    description: |
      Represents the external channels which are connected to the ADC.

    properties:
      reg:
        description: |
          The channel number. It can have up to 8 channels on ad4695 and ad4697
          and 16 channels on ad4696 and 4698, numbered from 0 to 15.
        items:
          minimum: 0
          maximum: 15

      adi,pair-select:
        description: |
          Select the pin-oairing option on the specific channel. Valid values
          are:
          0: Channel paired with REFGND.
          1: Channel paired with COM
          2: Even and odd channels pairing.
          If the channel is paired with REFGND, bipolar mode is not available.
          If even and odd channels pairing is selected, the channel number must
          be even.
        $ref: /schemas/types.yaml#/definitions/uint32
        enum: [0, 1, 2]

      adi,osr:
        description: |
          Select the oversampling ration select on the specific channel. Valid
          values are:
          0: OSR = 1 (no oversampling).
          1: OSR = 4. Output code result resolution increases to 17 bits.
          2: OSR = 16. Output code result resolution increases to 18 bits.
          3: OSR = 64. Output code result resolution increases to 19 bits.
          If this field is left empty, OSR = 1 is selected.
        $ref: /schemas/types.yaml#/definitions/uint32
        enum: [0, 1, 2, 3]

      bipolar:
        description: see Documentation/devicetree/bindings/iio/adc/adc.yaml
        type: boolean

    required:
      - reg
      - adi,pair-select

additionalProperties: false

allOf:
  - $ref: /schemas/spi/spi-peripheral-props.yaml#

examples:
  - |
    spi {
      #address-cells = <1>;
      #size-cells = <0>;

      adc@0 {
        compatible = "adi,ad4696";
        reg = <0>;
        spi-max-frequency = <80000000>;
        spi-cpha;
        spi-cpol;
        dmas = <&rx_dma 0>;
        dma-names = "rx";
        pwms = <&adc_trigger 0 0>;
        pwm-names = "cnv";
        clocks = <&spi_clk>;
        clock-names = "ref_clk";
        vref-supply = <&vref>;

        #address-cells = <1>;
        #size-cells = <0>;
        #io-channel-cells = <1>;

        channel@0 {
          reg = <0>;
          bipolar;
          adi,osr = <0>;
          adi,pair-select = <2>;
        };
        channel@2 {
          reg = <2>;
          adi,osr = <1>;
          adi,pair-select = <0>;
        };

        channel@3 {
          reg = <3>;
          adi,osr = <2>;
          adi,pair-select = <0>;
        };

        channel@4 {
          reg = <4>;
          adi,osr = <3>;
          adi,pair-select = <1>;
        };
      };
    };
